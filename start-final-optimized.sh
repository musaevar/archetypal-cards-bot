#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ Telegram-–±–æ—Ç–∞"
echo "======================================================"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ -z "$TELEGRAM_BOT_TOKEN" ]; then
    echo "‚ùå TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    exit 1
fi

if [ -z "$OPENAI_API_KEY" ]; then
    echo "‚ùå OPENAI_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    exit 1
fi

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
mkdir -p temp
mkdir -p logs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Node.js
if ! command -v node &> /dev/null; then
    echo "‚ùå Node.js –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js"
    exit 1
fi

echo "‚úÖ Node.js –Ω–∞–π–¥–µ–Ω: $(node --version)"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
pkill -f "bot-new-scenario.js" 2>/dev/null || true
pkill -f "bot-final-optimized.js" 2>/dev/null || true
sleep 2

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
echo "üöÄ –ó–∞–ø—É—Å–∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏..."
nohup node src/bot-final-optimized.js > logs/bot-final-optimized.log 2>&1 &
BOT_PID=$!

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ PID
echo $BOT_PID > bot-final-optimized.pid

echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω (PID: $BOT_PID)"
echo "üìã –õ–æ–≥–∏: tail -f logs/bot-final-optimized.log"
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞: kill $BOT_PID –∏–ª–∏ ./stop-final-optimized.sh"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
sleep 5
if kill -0 $BOT_PID 2>/dev/null; then
    echo "‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
    echo ""
    echo "üéØ –§–∏–Ω–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤–∫–ª—é—á–∞–µ—Ç:"
    echo "   ü§ñ GPT-4.1 –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ —Ç–µ–∫—Å—Ç–∞"
    echo "   ‚úçÔ∏è  –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–¥–∞–∫—Ç—É—Ä—ã –ú–∞–∫—Å–∏–º–∞ –ò–ª—å—è—Ö–æ–≤–∞"
    echo "   üé® –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–º–∞—Å–ª—è–Ω–∞—è –∂–∏–≤–æ–ø–∏—Å—å)"
    echo "   üìù –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ"
    echo "   üîÆ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã"
    echo "   üìù –Ø—Å–Ω—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ –∫–∞–Ω—Ü–µ–ª—è—Ä–∏–∑–º–æ–≤"
    echo "   üé® –ü–æ—ç—Ç–∞–ø–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –ª–æ–∞–¥–µ—Ä–∞–º–∏"
    echo "   üåâ –¢—Ä–∏ –∫–∞—Ä—Ç—ã: —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Ä–µ—Å—É—Ä—Å, –ø–µ—Ä–µ—Ö–æ–¥"
    echo "   üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ"
    echo "   üè• –°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç–∞"
    echo "   ‚ú® –ò—Ç–æ–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ —Å–µ—Å—Å–∏–∏"
    echo "   üîò Inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏"
    echo "   üé≠ –ê—Ä—Ö–µ—Ç–∏–ø–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å —Ç–∞—Ä–æ-–∫–∞—Ä—Ç"
else
    echo "‚ùå –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: cat logs/bot-final-optimized.log"
    exit 1
fi

echo ""
echo "üéâ –§–∏–Ω–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –∑–∞–ø—É—â–µ–Ω–∞!"
echo "üí° –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ./stop-final-optimized.sh"
