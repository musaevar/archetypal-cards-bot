#!/bin/bash

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Telegram-–±–æ—Ç–∞"
echo "========================="

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞
if [ -f "bot.pid" ]; then
    BOT_PID=$(cat bot.pid)
    if kill -0 $BOT_PID 2>/dev/null; then
        echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –±–æ—Ç–∞ (PID: $BOT_PID)..."
        kill $BOT_PID
        sleep 2
        
        # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –µ—Å–ª–∏ –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è
        if kill -0 $BOT_PID 2>/dev/null; then
            echo "‚ö†Ô∏è  –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞..."
            kill -9 $BOT_PID
        fi
        
        echo "‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
        echo "‚ÑπÔ∏è  –ë–æ—Ç —É–∂–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    fi
    rm -f bot.pid
else
    echo "‚ÑπÔ∏è  PID —Ñ–∞–π–ª –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
if [ -f "monitor.pid" ]; then
    MONITOR_PID=$(cat monitor.pid)
    if kill -0 $MONITOR_PID 2>/dev/null; then
        echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (PID: $MONITOR_PID)..."
        kill $MONITOR_PID
        echo "‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
        echo "‚ÑπÔ∏è  –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É–∂–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    fi
    rm -f monitor.pid
else
    echo "‚ÑπÔ∏è  PID —Ñ–∞–π–ª –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
if [ -d "temp" ]; then
    rm -rf temp/*
    echo "‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –æ—á–∏—â–µ–Ω—ã"
fi

# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
echo ""
echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Å—Å–∏–∏:"
if [ -f "logs/bot.log" ]; then
    echo "   - –°—Ç—Ä–æ–∫ –≤ –ª–æ–≥–µ –±–æ—Ç–∞: $(wc -l < logs/bot.log)"
fi
if [ -f "logs/monitor.log" ]; then
    echo "   - –°—Ç—Ä–æ–∫ –≤ –ª–æ–≥–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: $(wc -l < logs/monitor.log)"
fi

echo ""
echo "‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
