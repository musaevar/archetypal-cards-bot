#!/bin/bash

echo "๐ ะะฐะฟััะบ Telegram-ะฑะพัะฐ ั ัะผะพะดะทะธ ะธ ัะปัััะตะฝะฝัะผ UX"
echo "============================================="

# ะัะพะฒะตัะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
if [ -z "$TELEGRAM_BOT_TOKEN" ]; then
    echo "โ TELEGRAM_BOT_TOKEN ะฝะต ัััะฐะฝะพะฒะปะตะฝ"
    exit 1
fi

if [ -z "$OPENAI_API_KEY" ]; then
    echo "โ OPENAI_API_KEY ะฝะต ัััะฐะฝะพะฒะปะตะฝ"
    exit 1
fi

# ะกะพะทะดะฐะฝะธะต ะฝะตะพะฑัะพะดะธะผัั ะดะธัะตะบัะพัะธะน
mkdir -p temp
mkdir -p logs

# ะัะพะฒะตัะบะฐ Node.js
if ! command -v node &> /dev/null; then
    echo "โ Node.js ะฝะต ะฝะฐะนะดะตะฝ. ะฃััะฐะฝะพะฒะธัะต Node.js"
    exit 1
fi

echo "โ Node.js ะฝะฐะนะดะตะฝ: $(node --version)"

# ะััะฐะฝะพะฒะบะฐ ะฟัะตะดัะดััะธั ะฟัะพัะตััะพะฒ
echo "๐ ะััะฐะฝะพะฒะบะฐ ะฟัะตะดัะดััะธั ะฟัะพัะตััะพะฒ..."
pkill -f "bot-final-optimized.js" 2>/dev/null || true
pkill -f "bot-with-emojis.js" 2>/dev/null || true
sleep 2

# ะะฐะฟััะบ ะฑะพัะฐ ะฒ ัะพะฝะต ั ะปะพะณะธัะพะฒะฐะฝะธะตะผ
echo "๐ ะะฐะฟััะบ ะฑะพัะฐ ั ัะผะพะดะทะธ ะธ ัะปัััะตะฝะฝัะผ UX..."
nohup node src/bot-with-emojis.js > logs/bot-with-emojis.log 2>&1 &
BOT_PID=$!

# ะกะพััะฐะฝะตะฝะธะต PID
echo $BOT_PID > bot-with-emojis.pid

echo "โ ะะพั ะทะฐะฟััะตะฝ (PID: $BOT_PID)"
echo "๐ ะะพะณะธ: tail -f logs/bot-with-emojis.log"
echo "๐ ะััะฐะฝะพะฒะบะฐ: kill $BOT_PID ะธะปะธ ./stop-with-emojis.sh"

# ะัะพะฒะตัะบะฐ ัะตัะตะท 5 ัะตะบัะฝะด
sleep 5
if kill -0 $BOT_PID 2>/dev/null; then
    echo "โ ะะพั ัะฐะฑะพัะฐะตั ะบะพััะตะบัะฝะพ"
    echo ""
    echo "๐ฏ ะะตััะธั ั ัะผะพะดะทะธ ะธ ัะปัััะตะฝะฝัะผ UX ะฒะบะปััะฐะตั:"
    echo "   ๐ค GPT-4.1 ะดะปั ะปัััะตะณะพ ะบะฐัะตััะฒะฐ ัะตะบััะฐ"
    echo "   โ๏ธ  ะัะฐะฒะธะปะฐ ัะตะดะฐะบัััั ะะฐะบัะธะผะฐ ะะปัััะพะฒะฐ"
    echo "   ๐จ ะฃะฝะธัะธัะธัะพะฒะฐะฝะฝัะน ััะธะปั ะธะทะพะฑัะฐะถะตะฝะธะน (ะผะฐัะปัะฝะฐั ะถะธะฒะพะฟะธัั)"
    echo "   ๐ ะญะผะพะดะทะธ ะฒ ะบะปััะตะฒัั ะผะพะผะตะฝัะฐั ะดะปั ะปัััะตะณะพ UX"
    echo "   ๐ ะฃะฟัะพัะตะฝะฝะพะต ะฟัะธะฒะตัััะฒะธะต"
    echo "   ๐ฎ ะัะพัะตััะธะพะฝะฐะปัะฝัะต ะฟัะธัะพะปะพะณะธัะตัะบะธะต ะฟัะพะผะฟัั"
    echo "   ๐ ะฏัะฝัะน ะธ ะฟะพะฝััะฝัะน ัะตะบัั ะฑะตะท ะบะฐะฝัะตะปััะธะทะผะพะฒ"
    echo "   ๐จ ะะพััะฐะฟะฝะฐั ะณะตะฝะตัะฐัะธั ั ะปะพะฐะดะตัะฐะผะธ"
    echo "   ๐ ะขัะธ ะบะฐััั: ัะพััะพัะฝะธะต, ัะตัััั, ะฟะตัะตัะพะด"
    echo "   ๐ก ะัะฐะบัะธัะตัะบะพะต ะดะตะนััะฒะธะต"
    echo "   ๐ฅ ะกััะปะบะฐ ะฝะฐ ะฟัะธัะพัะตัะฐะฟะตะฒัะฐ"
    echo "   โจ ะัะพะณะพะฒัะน ะฐะฝะฐะปะธะท ัะตััะธะธ"
    echo "   ๐ Inline-ะบะฝะพะฟะบะธ ะดะปั ะฝะพะฒะพะน ัะตััะธะธ"
    echo "   ๐ญ ะััะตัะธะฟะธัะตัะบะธะน ััะธะปั ัะฐัะพ-ะบะฐัั"
else
    echo "โ ะะพั ะฝะต ะทะฐะฟัััะธะปัั. ะัะพะฒะตัััะต ะปะพะณะธ: cat logs/bot-with-emojis.log"
    exit 1
fi

echo ""
echo "๐ ะะพั ั ัะผะพะดะทะธ ะธ ัะปัััะตะฝะฝัะผ UX ะทะฐะฟััะตะฝ!"
echo "๐ก ะะปั ะพััะฐะฝะพะฒะบะธ ะธัะฟะพะปัะทัะนัะต: ./stop-with-emojis.sh"
